## `V2` -> `V2.1` Key Changes

Here are the key changes from the `v2 Dex` to the `v2.1 Dex`.
### LBFactory

#### Events 

```solidity
event PresetSet(
    uint256 baseFactor,
    uint256 filterPeriod,
    uint256 decayPeriod,
    uint256 reductionFactor,
    uint256 variableFeeControl,
    uint256 protocolShare,
    uint256 maxAccumulator,
    - uint256 sampleLifetime,
    + bool isOpen 
)
``` 
New variable `bool isOpen`. `uint256 sampleLifetime` removed. 

New event
```solidity 
PresetOpenStateChanged(uint256 indexed binStep, bool indexed isOpen)
``` 

`FeeParametersSet` moved to -> `LBPair` (`StaticFeeParametersSet`)

#### Functions

```solidity
function setPreset(
    uint16 binStep,
    uint16 baseFactor,
    uint16 filterPeriod,
    uint16 decayPeriod,
    uint16 reductionFactor,
    uint24 variableFeeControl,
    uint16 protocolShare,
    uint24 maxVolatilityAccumulator,
    + bool isOpen
    - uint16 sampleLifetime
)
```
Removed
```solidity
function MAX_FEE(), 
function MIN_BIN_STEP(),
function MAX_BIN_STEP(),
function MAX_PROTOCOL_SHARE(),
```
Replaced by:

```solidity
GetMinBinStep, GetMaxFlashLoanFee
```

### LBFlashLoanCallback

```solidity
function LBFlashLoanCallback(
    address sender,
    IERC20 tokenX,
    IERC20 tokenY,
    bytes32 amounts,
    bytes32 totalFees,
    bytes calldata data
) external returns (bytes32)
```

Decode bytes32:

### LBPair 
`Struct Bin` remove -> now bytes32

New:
```function StaticFeeParametersSet``` now at a pair level

#### Events 

Some returned variables are now `bytes32` types and needs to be decoded:
```solidity
event DepositedToBins(address indexed sender, address indexed to, uint256[] ids, bytes32[] amounts)
```
To decode an element of `amounts` follow the code example.
```solidity
event WithdrawnFromBins(address indexed sender, address indexed to, uint256[] ids, bytes32[] amounts)
```
```solidity
event CompositionFees(address indexed sender, uint24 id, bytes32 totalFees, bytes32 protocolFees)
```
`totalFees` and `protocolFees` are now `bytes32`. To decode them follow the examples.

```solidity
event CollectedProtocolFees(address indexed feeRecipient, bytes32 protocolFees)
```
```solidity
event Swap(
    address indexed sender,
    address indexed to,
    uint24 id,
    bytes32 amountsIn, 
    bytes32 amountsOut,
    uint24 volatilityAccumulator,
    bytes32 totalFees,
    bytes32 protocolFees
)
```
`amountsIn, `amountsOut` are `bytes32` and can be decoded as per the code example.

```solidity
event FlashLoan(
    address indexed sender,
    ILBFlashLoanCallback indexed receiver,
    uint24 activeId,
    bytes32 amounts,
    bytes32 totalFees,
    bytes32 protocolFees
)
```
`totalFees, `protocolFees` are `bytes32` and can be decoded as per the code example.

#### Function

Functions Updated:

```solidity
function swap(bool swapForY, address to) external returns (bytes32 amountsOut)
```
Now return `amountsOut` as a `bytes32`.

```solidity
function flashLoan(ILBFlashLoanCallback receiver, bytes32 amounts, bytes calldata data) external
```
```solidity
function mint(address to, bytes32[] calldata liquidityConfigs, address refundTo)
        external
        returns (bytes32 amountsReceived, bytes32 amountsLeft, uint256[] memory liquidityMinted);
```
```
function burn(address from, address to, uint256[] calldata ids, uint256[] calldata amountsToBurn)
        external
        returns (bytes32[] memory amounts);
```
```solidity
function collectProtocolFees() external returns (bytes32 collectedProtocolFees);
```

New Functions:

`getReservesAndId` splitted into 2 new functions:
```solidity
function getReserves() external view returns (uint128 reserveX, uint128 reserveY);
```
&
```solidity
function getActiveId() external view returns (uint24 activeId);
```

```solidity
function getNextNonEmptyBin(bool swapForY, uint24 id) external view returns (uint24 nextId);
```
```solidity
function getProtocolFees() external view returns (uint128 protocolFeeX, uint128 protocolFeeY);
```
```solidity
function getStaticFeeParameters()
    external
    view
    returns (
        uint16 baseFactor,
        uint16 filterPeriod,
        uint16 decayPeriod,
        uint16 reductionFactor,
        uint24 variableFeeControl,
        uint16 protocolShare,
        uint24 maxVolatilityAccumulator
);
```
```solidity
function getVariableFeeParameters()
        external
        view
        returns (uint24 volatilityAccumulator, uint24 volatilityReference, uint24 idReference, uint40 timeOfLastUpdate);
```

### LBRouter

Support now quotes from JoeV1, Legacy LB Pairs and New LB Pairs.

Function Updated:

Updated the different function to support multichains:<br/>
```function addLiquidityNATIVE``` <br/>
```removeLiquidityNATIVE```<br/>
```swapExactTokensForNATIVE```<br/>
```swapExactNATIVEForTokens```<br/>
```swapTokensForExactNATIVE```<br/>
```swapNATIVEForExactTokens```<br/>
```swapExactTokensForNATIVESupportingFeeOnTransferTokens```<br/>
```swapExactNATIVEForTokensSupportingFeeOnTransferTokens```<br/>

### LBToken

Function `safeTransferFrom` and `safeBatchTransferFrom` are removed.

### LBQuoter

`findBestPathFromAmountOut` and `findBestPathFromAmountIn` get the best quote over `JoeV1`, `v2` and `v2.1`.

### Additonnal Noticable Changes


Added the Legacy interfaces and of the `v2` Pairs.